<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>frankrowe.org</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href='http://fonts.googleapis.com/css?family=Oxygen:400,300' rel='stylesheet' type='text/css'>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="topbar"></div>
    <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <div class="contact-bar">
          <a href="/" class="marker"><img src="/img/locality-green2x.png" alt=""></a>
          <ul class="navigation">
            <li><a href="/">frankrowe.org</a></li>
            <li><a href="https://twitter.com/fsrowe">@fsrowe</a></li>
            <li><a href="https://github.com/frankrowe">GitHub</a></li>
            <li><a href="/archive.html">Archive</a></li>
            <li><a href="/about.html">About</a></li>
          </ul>
        </div>
      </div>
    </div>
      <div class="row">
        <div class="col-md-12"><div class="post">
  <h2><a href="/posts/2015/05/04/iso-simplify.html">Simplify a GeoJSON file in iso</a></h2>
  <p class="date">May 04, 2015</p>
  <p style="text-align: center"><img src="/img/iso1.gif" class="img-responsive"></p>
<p>Open a .geojson file in iso, select the feature you want to edit, and choose Feature > Transformation > Simplify. Input your simplification tolerance, and hit OK. You can then save your layer as a new geojson file.</p>
<p><a href="http://turfjs.org/static/docs/module-turf_simplify.html">Turf's simplify API</a></p>
<p><a href="http://frankrowe.org/iso/">iso</a></p>

</div><div class="post">
  <h2><a href="/posts/2015/03/17/postgis-to-protobuf.html">PostGIS to Protobuf (with vector tiles)</a></h2>
  <p class="date">Mar 17, 2015</p>
  <p style="text-align: center"><img src="/img/vector-tiles.jpg" class="img-responsive"></p>
<p>I have seen a lot of talk about <a href="https://github.com/google/protobuf/">protobol buffers</a> and <a href="https://www.mapbox.com/developers/vector-tiles/">vector tiles</a> recently, which promises improved performance loading and rendering layers than just plain geojson. I've seen a lot of demos of the tech, but had trouble putting it all together. This is my first attempt at creating a server that will query PostGIS, serve vector tiles encoded into protobuf, and render them on a Leaflet map.</p>
<p>Create a layer in Leaflet, using the excellent <a href="https://github.com/SpatialServer/Leaflet.MapboxVectorTile">Leaflet.MapboxVectorTile</a> plugin.</p>
<pre><code class="js">var vectorTileLayer = new L.TileLayer.MVTSource({
  url: '/vector-tiles/layername/{z}/{x}/{y}.pbf',
  clickableLayers: ['layername'],
  getIDForLayerFeature: function(feature) {
    return feature._id
  }
})
map.addLayer(vectorTileLayer)</code></pre>
<p>Create a route to match the above URL. Create a node server with Express, and add a route similar to a standard tile layer:</p>
<pre><code class="js">router.get('/vector-tiles/:layername/:z/:x/:y.pbf', function(req, res) {

})</code></pre>
<p>Get the bounding box of our data, using the <a href="https://www.npmjs.com/package/sphericalmercator">sphericalmercator</a> library</p>
<pre><code class="js">var SphericalMercator = require('sphericalmercator')
var mercator = new SphericalMercator({
  size: 256 //tile size
})
var bbox = mercator.bbox(
  +req.params.x,
  +req.params.y,
  +req.params.z,
  false,
  '4326'
)</code></pre>
<p>Use this bounding box to query PostGIS for the data we need for this tile. Convert the resulting rows into a single geojson feature collection.</p>
<pre><code class="sql">select st_asgeojson(geom) as feature from table where st_intersects(geom, bbox)
</code></pre>
<p>Now that we have the geojson for the tile, we can create a vector tile using <a href="https://www.npmjs.com/package/mapnik">node-mapnik</a></p>
<pre><code class="js">var mapnik = require('mapnik')
var vtile = new mapnik.VectorTile(+req.params.z, +req.params.x, +req.params.y)
vtile.addGeoJSON(JSON.stringify(geojson), 'layername')</code></pre>
<p>Finally, use vtile.getData() to get the protobuf-encoded buffer from the vector tile, pass it through zlib.deflate to compress, set the correct headers, and serve it.</p>
<pre><code class="js">res.setHeader('Content-Encoding', 'deflate')
res.setHeader('Content-Type', 'application/x-protobuf')
zlib.deflate(vtile.getData(), function(err, pbf) {
  res.send(pbf)
})
</code></pre>
<p>Your vectorTileLayer in Leaflet should now be working.</p>
<p>So far, this seems to load complex layers much faster than querying and returning the entire geojson for a bounding box, and has the advantage of sending actual vector data to the client, unlike a traditional tile layer.</p>
<p>Discuss with me on <a href="https://twitter.com/fsrowe">twitter</a>.</p>
</div><div class="post">
  <h2><a href="/posts/2015/02/25/so-long.html">So Long</a></h2>
  <p class="date">Feb 25, 2015</p>
  <p style="text-align: center"><img src="/img/so-long.png" class="img-responsive"></p>
<p>Today I pushed to master on <a href="http://esrgc.org">esrgc.org</a>, removing myself from the About page. It ends a five year long journey at the co-op. I learned so much in my time there, about programming and life in general. It was the perfect place to begin my career.</p>
<p>For now,  I'll continue freelancing in the geospatial field. I'm going to focus on creating and contributing to open source tools and the open source community. My goal moving forward is simple and has not changed: to work on software that people want to use.</p>
</div><div class="post">
  <h2><a href="/posts/2015/01/17/maryland-geojson.html">Maryland in GeoJSON</a></h2>
  <p class="date">Jan 17, 2015</p>
  <p style="text-align: center"><img src="/img/maryland-geojson.png" class="img-responsive"></p>
<p>Useful political boundaries of Maryland in GeoJSON format.</p>
<p><a href="https://github.com/frankrowe/maryland-geojson">https://github.com/frankrowe/maryland-geojson</a></p>
</div><div class="post">
  <h2><a href="/posts/2014/12/04/better-chart-hover.html">Improved GeoDash Interaction</a></h2>
  <p class="date">Dec 04, 2014</p>
  <p class="text-center"><img src="/img/geodash-hover.png" class="img-responsive"></p>
<p>Hovering points on line charts was becoming harder and harder as data size increased and point radius decreased. Solution? Bigger mouse targets on top of data points. Reduce target opacity to zero and find the matching data point on mouse over, and bam - much better interactivity.</p>
<p>Live demo: <a href="http://frankrowe.github.io/geodash/">http://frankrowe.github.io/geodash/</a></p>
</div><div class="post">
  <h2><a href="/posts/2014/12/02/leaflet-crosshairs.html">Leaflet Crosshairs</a></h2>
  <p class="date">Dec 02, 2014</p>
  <p><img src="/img/leaflet-crosshairs.jpeg" class="img-responsive"></p>
<p>Leaflet.Crosshairs is a leaflet plugin to turn a mouse cursor into a crosshairs on map hover.</p>
<p>This works well for determining lat/long coordinates when combined with map graticules.</p>
<p>Live demo: <a href="http://frankrowe.github.io/Leaflet.Crosshairs/">http://frankrowe.github.io/Leaflet.Crosshairs/</a></p>
<p>GitHub: <a href="https://github.com/frankrowe/Leaflet.Crosshairs">https://github.com/frankrowe/Leaflet.Crosshairs</a></p>
</div><div class="post">
  <h2><a href="/posts/2014/08/15/geodash.html">GeoDash</a></h2>
  <p class="date">Aug 15, 2014</p>
  <p class="text-center"><img src="/img/geodash.png" class="img-responsive"></p>
<p>GeoDash is a minimal javascript chart library. It's built on <a href="http://d3js.org">D3</a> and supports horizontal and vertical bar charts, stacked bar charts, pie charts and line charts.</p>
<p>Why is it called GeoDash? Mostly because I built this while building "geodashboards" that usually involved a map. Also because using "geo" in anything makes it cool.</p>
<p>Live demo: <a href="http://frankrowe.github.io/geodash/">http://frankrowe.github.io/geodash/</a></p>
</div><div class="post">
  <h2><a href="/posts/2014/07/24/cloud-render.html">Map Rendering with TileMill and Amazon EC2</a></h2>
  <p class="date">Jul 24, 2014</p>
  <p><img src="/img/denver.jpeg" class="img-responsive"></p>
<p>Rendering with TileMill and PostGIS on Amazon EC2.</p>
<p>1. Load data into PostGIS.</p>
<p>2. Create shapefile of desired map.</p>
<p>3. Create local TileMill project to generate project.mml file.</p>
<p>4. Create Amazon EC2 server loaded with TileMill. Use Springmeyer's awesome <a href="https://gist.github.com/springmeyer/b0bbcd976378cf3e4e44">guide</a> for this.</p>
<p>5. Upload shapefile to EC2 server.</p>
<p>6. Upload tilemill project to EC2 server.</p>
<p>7. Render map to mbtiles.</p>
<p>8. Download mbtiles to wherever the map will be served.</p>
<p>9. ???</p>
<p>10. Profit.</p>
</div>        </div>
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-60186639-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad()</script>
  </body>
</html>
